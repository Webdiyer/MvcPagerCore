"use strict"; var Webdiyer = Webdiyer || {}; Webdiyer.MvcPagers = [], Webdiyer.MvcPagers.getById = function (e) { for (var a = 0; a <= this.length; a++)if ("undefined" != typeof this[a] && this[a].id === e) return this[a]; return null }, Webdiyer.__ajaxPages = {}, Webdiyer.MvcPager = function (e) { this.wrapper = e }, Webdiyer.MvcPager.prototype = { wrapper: null, id: null, urlFormat: null, pageIndexName: null, updateTarget: null, onBegin: null, onComplete: null, onFailure: null, onSuccess: null, httpMethod: null, confirm: null, loadingElementId: null, loadingDuration: 0, partialLoading: null, currentPageIndex: null, dataFormId: null, allowCache: !0, enableHistorySupport: null, searchCriteria: null, pageCount: null, invalidPageErrMsg: null, outOfRangeErrMsg: null, firstPageUrl: null, pageIndexBox: null, goToButton: null, maxPageIndexItems: 20, isAjaxPager: null, onError: null, isFirstLoading: !0, allowReload: !1, init: function () { var e, a = $(this.wrapper), t = 1; this.id = a.attr("id"), this.isAjaxPager = a.data("ajax") || !1, this.pageCount = a.data("pagecount"), this.invalidPageErrMsg = a.data("invalidpageerrmsg"), this.outOfRangeErrMsg = a.data("outrangeerrmsg"), this.firstPageUrl = a.data("firstpage"), this.urlFormat = a.data("urlformat"), this.pageIndexName = a.data("pageparameter"), this.currentPageIndex = a.data("currentpage") || 1, this.pageIndexBox = a.data("pageindexbox"), this.goToButton = a.data("gotobutton"), this.maxPageIndexItems = a.data("maxitems") || 20, this.onError = a.data("onerror") || "alert(errMsg)"; var n = this; if (this.isAjaxPager) { this.updateTarget = a.data("ajax-update"), this.onBegin = a.data("ajax-begin"), this.onComplete = a.data("ajax-complete"), this.onFailure = a.data("ajax-failure"), this.onSuccess = a.data("ajax-success"), this.confirm = a.data("ajax-confirm") || void 0, this.httpMethod = a.data("ajax-method") || "GET", this.loadingElementId = a.data("ajax-loading") || void 0, this.dataFormId = a.data("ajax-dataformid") || void 0, this.allowCache = a.data("ajax-allowcache") || !0; var i = a.data("ajax-enablehistorysupport"); this.enableHistorySupport = "undefined" == typeof i ? !0 : i, this.loadingDuration = a.data("ajax-loading-duration") || 0, this.partialLoading = a.data("ajax-partialloading") || !1, e = this.currentPageIndex; var r = "[data-pager-type='Webdiyer.MvcPager']", o = this.__getPageIndex(this.pageIndexName); if (o !== this.currentPageIndex && o > 0 && this.__ajax(o, { type: this.httpMethod, data: [] }), "undefined" != typeof this.dataFormId) { var d = $(n.dataFormId).data("ajax") || !1; $(n.dataFormId).submit(function (e) { n.searchCriteria = $(n.dataFormId).serializeArray(), d ? 1 !== n.currentPageIndex ? (n.currentPageIndex = 1, n.enableHistorySupport ? (n.__setPageIndex(n.pageIndexName, -1), n.allowReload = !0) : n.__ajax(1, { type: n.httpMethod, data: [] })) : "undefined" == typeof Webdiyer.__ajaxPages[n.pageIndexName] && (n.allowReload = !0) : ("undefined" == typeof Webdiyer.__ajaxPages[n.pageIndexName] && (n.allowReload = !0), 1 === n.currentPageIndex ? n.__ajax(1, { type: n.httpMethod, data: [] }) : (n.enableHistorySupport ? n.__setPageIndex(n.pageIndexName, 1) : n.__ajax(1, { type: n.httpMethod, data: [] }), n.currentPageIndex = 1), n.allowReload = !0, e.preventDefault()) }) } this.enableHistorySupport && this.__initHashChange(e), $(this.updateTarget).on("click", r + " a[data-pageindex]", function (e) { t = $(this).data("pageindex"), e.preventDefault(), n.enableHistorySupport ? n.__setPageIndex(n.pageIndexName, t) : n.__ajax(t, { type: n.httpMethod, data: [] }) }) } return this.__bindPageIndexBox(), this }, __bindPageIndexBox: function () { var e = this; e.isAjaxPager ? "" !== $.trim(e.pageIndexBox) && ($(e.updateTarget).find(e.pageIndexBox).length > 0 ? (e.__fillPageIndexBox(), $(e.pageIndexBox).is("input:text") && ($(e.pageIndexBox).val(e.currentPageIndex), $(e.updateTarget).on("keydown", e.pageIndexBox, function () { e.__validateInput(event) })), "" !== $.trim(e.goToButton) ? $(e.updateTarget).on("click", e.goToButton, function () { var a = $(e.pageIndexBox).val(); e.goToPage(a) }) : $(e.updateTarget).on("change", e.pageIndexBox, function () { var a = $(e.pageIndexBox).val(); e.goToPage(a) })) : e.__bindBoxEvents()) : "" !== $.trim(e.pageIndexBox) && e.__bindBoxEvents() }, __bindBoxEvents: function () { var e = this; e.__fillPageIndexBox(), $(e.pageIndexBox).is("input:text") && ($(e.pageIndexBox).val(e.currentPageIndex), $(e.pageIndexBox).keydown(function () { e.__validateInput(event) })), "" !== $.trim(e.goToButton) ? $(e.goToButton).click(function () { var a = $(e.pageIndexBox).val(); e.goToPage(a) }) : $(e.pageIndexBox).change(function () { var a = $(e.pageIndexBox).val(); e.goToPage(a) }) }, __fillPageIndexBox: function () { var e = $(this.pageIndexBox); if ("select-one" === e.prop("type")) { e.empty(); var a = this.currentPageIndex - this.maxPageIndexItems / 2; a + this.maxPageIndexItems > this.pageCount && (a = this.pageCount + 1 - this.maxPageIndexItems), 1 > a && (a = 1); var t = a + this.maxPageIndexItems - 1; t > this.pageCount && (t = this.pageCount); for (var n = a; t >= n; n++)e.append('<option value="' + n + '">' + n + "</option>") } e.val(this.currentPageIndex) }, __initHashChange: function (e) { var a = this, t = document.documentMode; if ("onhashchange" in window && (void 0 === t || t > 7)) $(window).bind("hashchange", function () { var t = a.__getPageIndex(a.pageIndexName); 0 === t && (t = e), a.__ajax(t, { type: a.httpMethod, data: [] }) }); else { var n = window.location.hash; setInterval(function () { var t = a.__getPageIndex(a.pageIndexName); window.location.hash !== n && (n = window.location.hash, 0 === t && (t = e), a.__ajax(t, { type: a.httpMethod, data: [] })) }, 200) } }, __getPageIndex: function (e) { var a = window.location.hash.substring(1); if ("" !== $.trim(a)) for (var t = a.split("&"), n = 0; n < t.length; n++) { var i = t[n].split("="); if (i[0].toString().toLowerCase() === e.toString().toLowerCase()) return parseInt(i[1]) || 1 } return 0 }, __setPageIndex: function (e, a) { var t = window.location.hash.substring(1); if ("" === $.trim(t)) window.location.hash = e + "=" + a; else { var n = new RegExp(e + "=[^&]*", "i"); if (n.test(t)) { var i = t.replace(n, e + "=" + a); window.location.hash = i } else window.location.hash += "&" + e + "=" + a } }, goToPage: function (e) { var a = new RegExp("^\\s*(\\d+)\\s*$"); return a.test(e) ? RegExp.$1 < 1 || RegExp.$1 > this.pageCount ? void this.__getFunction(this.onError, ["errType", "errMsg"]).apply(this, [1, this.outOfRangeErrMsg]) : void (this.isAjaxPager ? this.enableHistorySupport ? this.__setPageIndex(this.pageIndexName, e) : this.__ajax(e, { type: this.httpMethod, data: [] }) : "undefined" != typeof this.firstPageUrl && this.firstPageUrl !== !1 && 1 === parseInt(e) ? window.self.location.href = this.firstPageUrl : window.self.location.href = decodeURI(this.urlFormat).replace("__" + this.pageIndexName + "__", e)) : void this.__getFunction(this.onError, ["errType", "errMsg"]).apply(this, [0, this.invalidPageErrMsg]) }, __ajax: function (e, a) { var t = this; if ("undefined" == typeof Webdiyer.__ajaxPages[t.pageIndexName] || Webdiyer.__ajaxPages[t.pageIndexName] !== e || t.allowReload) { if (-1 === e || 0 === e && t.isFirstLoading || e === t.currentPageIndex && !t.allowReload) return; if (t.confirm && !window.confirm(t.confirm)) return; $.extend(a, { url: this.urlFormat.replace("__" + t.pageIndexName + "__", e), cache: this.allowCache, beforeSend: function (e) { var n = a.type.toUpperCase(); "GET" !== n && "POST" !== n && e.setRequestHeader("X-HTTP-Method-Override", n); var i = t.__getFunction(t.onBegin, ["xhr"]).apply(this, arguments); return i !== !1 && "undefined" != typeof t.loadingElementId && $(t.loadingElementId).show(t.loadingDuration), i }, complete: function () { "undefined" != typeof t.loadingElementId && $(t.loadingElementId).hide(t.loadingDuration), t.__fillPageIndexBox(), t.__getFunction(t.onComplete, ["xhr", "status"]).apply(this, arguments) }, success: function (a) { t.partialLoading ? $(t.updateTarget).html($(t.updateTarget, a).html()) : $(t.updateTarget).html(a), t.currentPageIndex = e, t.isFirstLoading = !1, t.__getFunction(t.onSuccess, ["data", "status", "xhr"]).apply(this, arguments) }, error: t.__getFunction(t.onFailure, ["xhr", "status", "error"]) }), "undefined" != typeof t.dataFormId && t.__pushData(a.data, t.searchCriteria), a.data.push({ name: "X-Requested-With", value: "XMLHttpRequest" }); var n = a.type.toUpperCase(); "GET" !== n && "POST" !== n && (a.type = "POST", a.data.push({ name: "X-HTTP-Method-Override", value: n })), $.ajax(a), Webdiyer.__ajaxPages[t.pageIndexName] = e } }, __pushData: function (e, a) { if (null !== a && "undefined" != typeof a) for (var t = 0; t < a.length; t++)e.push({ name: a[t].name, value: a[t].value }) }, __getFunction: function (e, a) { for (var t = window, n = (e || "").split("."); t && n.length;)t = t[n.shift()]; if ("function" == typeof t) return t; if (0 === $.trim(e).toLowerCase().indexOf("function")) return new Function("return (" + e + ").apply(this,arguments);"); a.push(e); try { return Function.constructor.apply(null, a) } catch (i) { alert("Error:\r\n" + e + "\r\n is not a valid callback function") } }, __validateInput: function (e) { var a; window.event ? a = e.keyCode : e.which && (a = e.which); var t = [8, 37, 39, 46, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105]; null !== a && t.indexOf(a) < 0 && (e.preventDefault ? e.preventDefault() : event.returnValue = !1) } }, function (e) { e.fn.initMvcPagers = function () { return this.each(function () { Webdiyer.MvcPagers.push(new Webdiyer.MvcPager(this).init()) }) } }(jQuery), $(function () { $("[data-pager-type='Webdiyer.MvcPager']").initMvcPagers() });